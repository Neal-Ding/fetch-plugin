"use strict";require("whatwg-fetch");var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},globalHeaders={"Content-Type":"application/json"},globalOption={headers:new Headers(globalHeaders),mode:"same-origin",credentials:"include",cache:"reload",redirect:"follow",referrer:"client",timeout:3e4,fetchStart:function(e){return e}},mergeOptions=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=_extends.apply(void 0,[{}].concat(t)),o=_extends({},globalHeaders,r.headers),i=null;return(i=_extends({},globalOption,r)).headers=new Headers(o),{resultOptions:i,resultHealers:o}},setOptions=function(e){globalOption=mergeOptions(e).resultOptions,globalHeaders=mergeOptions(e).resultHealers},parseJSON=function(n){return n.text().then(function(t){try{return JSON.parse(t)}catch(e){throw new Error("JSON Parse Error: "+e+", URL: "+n.url+", "+t.slice(0,500))}})},checkStatus=function(e){if(200<=e.status&&e.status<300||304==e.status)return e;throw new Error("HTTP Status Code: "+e.status+", URL: "+e.url)},setGetURL=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("[object Object]"!==Object.prototype.toString.call(t)||0===Object.keys(t).length)return e;var n=[];for(var r in t)n.push(encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e+(-1===e.indexOf("?")?"?":"")+n.join("&")},getJSON=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=mergeOptions({method:"GET"},n).resultOptions,o=setGetURL(e,t);return _fetch(o,r).then(parseJSON).then(handleFetchPass,handleFetchError)},deleteJSON=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=mergeOptions({method:"DELETE"},n).resultOptions,o=setGetURL(e,t);return _fetch(o,r).then(parseJSON).then(handleFetchPass,handleFetchError)},postJSON=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=mergeOptions({method:"POST",body:JSON.stringify(t)},n).resultOptions;return _fetch(e,r).then(parseJSON).then(handleFetchPass,handleFetchError)},putJSON=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=mergeOptions({method:"PUT",body:JSON.stringify(t)},n).resultOptions;return _fetch(e,r).then(parseJSON).then(handleFetchPass,handleFetchError)},handleFetchPass=function(e){return"function"==typeof globalOption.fetchSuccess&&globalOption.fetchSuccess(e),e},handleFetchError=function(e){throw"function"==typeof globalOption.fetchError&&globalOption.fetchError(e),e=e instanceof Error?e:new Error(e)},getJSONP=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r="jsonp"+ +new Date,o=document.createElement("script");t[n.callbackName||"_callback"]=r;var i=setGetURL(e,t),s=document.head||document.querySelector("head")||document.documentElement;return o.setAttribute("src",i),o.setAttribute("charset","utf-8"),o.setAttribute("defer",!0),o.setAttribute("async",!0),s.insertBefore(o,s.firstChild),new Promise(function(t,e){window[r]=function(e){t(e),s.removeChild(o)},o.onerror=function(){e(),s.removeChild(o)}})},_fetch=function(o,i){return new Promise(function(t,n){var r=0;Promise.resolve(i.fetchStart({url:o,fetchOption:i})).then(function(t){var e=new Request(t.url,t.fetchOption);return r=setTimeout(function(){var e=new Error(t.url+" timeout");e.fetchOption=t.fetchOption,n(e)},t.fetchOption.timeout),fetch(e)}).then(function(e){clearTimeout(r),e.fetchOption=i,t(e)},function(e){clearTimeout(r),e.url=o,e.fetchOption=i,n(e)})}).then(checkStatus)},main={setOptions:setOptions,getJSONP:getJSONP,getJSON:getJSON,postJSON:postJSON,putJSON:putJSON,deleteJSON:deleteJSON};module.exports=main;
